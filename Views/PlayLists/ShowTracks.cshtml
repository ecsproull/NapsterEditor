@model Tracks

@{
    ViewData["Title"] = "Play Lists";
    Layout = "~/Views/Shared/_StartLayout.cshtml";
    ViewBag.PageHeading = "Tracks";
}

 @section JavaScript {
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="~/lib/napster/napster.js"></script>
    <script language="javascript">
        var trackPlaying;
        function play(track) {
            trackPlaying = track;
            Napster.player.play(track);
        }

        function stopPlayer() {
            Napster.player.pause();
        }

        function load(clientId) {
            Napster.init({
                consumerKey: localStorage.getItem("clientId")
            });

            Napster.player.on('ready', function (e) {
                Napster.member.set({
                    accessToken: localStorage.getItem("accessToken"),
                    refreshToken: localStorage.getItem("refreshToken")
                });
                Napster.player.auth();
            });

            Napster.player.on('playevent', function (e) {
                if (e.data.code == 'PlayComplete') {
                    $.get("/Playlists/GetNextTrack", { currentTrack: trackPlaying }, function (data) {
                        play(data);
                    });
                }
            });
        }
    </script>
}

<div class="container-fluid text-center">
    <div class="playlist">
        <div class="logon">
            <div class="lg-rnd-border mt-3 mb-3 list-inline-item px-1">
                <a class="tool-btn m-2" href="/PlayLists/Shuffle">Shuffle</a>
                <a class="tool-btn m-2" href="/PlayLists/MarkDups">Mark Dups</a>
                <a class="tool-btn m-2" href="/PlayLists/Save">Save</a>
            </div>
            <h4 class="pt-2">Playlist Name: @Model.PlayListName</h4>
        </div>
        <table class="tracksTable">
            <tr>
                <th><a href="/playlists/Sort?sortItem=Title">Title</a></th>
                <th><a href="/playlists/Sort?sortItem=Artist">Artist</a></th>
                <th><a href="/playlists/Sort?sortItem=Album">Album</a></th>
            </tr>
            @foreach (var m in Model.TrackList)
            {
                <tr>
                    <td onclick="play('@m.Id')"><a href="javascript:void(0);">@m.Name</a></td>
                    <td>@m.ArtistName</td>
                    <td>@m.AlbumName</td>
                </tr>
            }
        </table>
        <iframe name="player-frame"
                id="player-frame"
                src="http://api.napster.com/v1.1/player/index.html?apikey=@Model.ClientId"
                frameborder="0"
                onload="load('@Model.ClientId')"
                style="border-color: #f00;
        border-width: 2px;
        border-style: solid;
        border-radius: 6px;
        background-color:#ccc;">
        </iframe>
    </div>
</div>
